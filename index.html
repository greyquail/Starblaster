<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>StarBlaster</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      touch-action: none;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    // Constants and Setup
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let W = window.innerWidth;
    let H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;

    window.addEventListener("resize", () => {
      W = window.innerWidth;
      H = window.innerHeight;
      canvas.width = W;
      canvas.height = H;
    });

    // Game Variables
    let keys = {};
    let bullets = [];
    let enemies = [];
    let particles = [];
    let score = 0;

    // Player Object
    const player = {
      x: W / 2,
      y: H - 60,
      size: 30,
      speed: 6,
      color: "#0ff",
      cooldown: 0,
      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.beginPath();
        ctx.moveTo(0, -this.size);
        ctx.lineTo(this.size / 2, this.size);
        ctx.lineTo(-this.size / 2, this.size);
        ctx.closePath();
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.restore();
      },
      update() {
        if (keys["ArrowLeft"] || keys["a"]) this.x -= this.speed;
        if (keys["ArrowRight"] || keys["d"]) this.x += this.speed;
        this.x = Math.max(this.size / 2, Math.min(W - this.size / 2, this.x));
        if (this.cooldown > 0) this.cooldown--;
      },
      shoot() {
        if (this.cooldown === 0) {
          bullets.push({ x: this.x, y: this.y - this.size, size: 5, speed: 8 });
          this.cooldown = 10;
        }
      }
    };

    // Touch Controls
    let touchX = null;
    canvas.addEventListener("touchstart", e => {
      touchX = e.touches[0].clientX;
      player.shoot();
    });

    canvas.addEventListener("touchmove", e => {
      touchX = e.touches[0].clientX;
      if (touchX < W / 2) keys["ArrowLeft"] = true;
      else keys["ArrowRight"] = true;
    });

    canvas.addEventListener("touchend", () => {
      keys["ArrowLeft"] = false;
      keys["ArrowRight"] = false;
    });

    // Keyboard Controls
    window.addEventListener("keydown", e => {
      keys[e.key] = true;
      if (e.key === " ") player.shoot();
    });

    window.addEventListener("keyup", e => {
      keys[e.key] = false;
    });

    // Draw Bullets
    function drawBullets() {
      ctx.fillStyle = "#ff0";
      bullets.forEach((b, i) => {
        b.y -= b.speed;
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2);
        ctx.fill();
        if (b.y < 0) bullets.splice(i, 1);
      });
    }

    // Spawn Enemies
    let enemyTimer = 0;
    function spawnEnemies() {
      if (enemyTimer <= 0) {
        for (let i = 0; i < 3; i++) {
          enemies.push({
            x: Math.random() * (W - 30) + 15,
            y: -30,
            size: 20,
            speed: Math.random() * 2 + 1,
            color: `hsl(${Math.random() * 360}, 100%, 50%)`
          });
        }
        enemyTimer = 60;
      } else {
        enemyTimer--;
      }
    }

    function drawEnemies() {
      enemies.forEach((e, ei) => {
        e.y += e.speed;
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
        ctx.fillStyle = e.color;
        ctx.fill();
        if (e.y > H + 30) enemies.splice(ei, 1);
      });
    }

    // Collision
    function checkCollisions() {
      bullets.forEach((b, bi) => {
        enemies.forEach((e, ei) => {
          let dx = b.x - e.x;
          let dy = b.y - e.y;
          let dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < e.size + b.size) {
            score += 100;
            bullets.splice(bi, 1);
            enemies.splice(ei, 1);
            spawnParticles(e.x, e.y, e.color);
          }
        });
      });
    }

    function spawnParticles(x, y, color) {
      for (let i = 0; i < 10; i++) {
        particles.push({
          x, y,
          dx: (Math.random() - 0.5) * 4,
          dy: (Math.random() - 0.5) * 4,
          life: 30,
          color
        });
      }
    }

    function drawParticles() {
      particles.forEach((p, i) => {
        p.x += p.dx;
        p.y += p.dy;
        p.life--;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 2, 2);
        if (p.life <= 0) particles.splice(i, 1);
      });
    }

    function drawScore() {
      ctx.fillStyle = "#fff";
      ctx.font = "bold 20px sans-serif";
      ctx.fillText(`Score: ${score}`, 10, 30);
    }

    // Game Loop
    function gameLoop() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, W, H);

      player.update();
      player.draw();
      drawBullets();
      spawnEnemies();
      drawEnemies();
      checkCollisions();
      drawParticles();
      drawScore();

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
